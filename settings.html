<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lexfall Settings</title>
  <style>
    :root { --bg:#f0f0f0; --panel:#ffffff; --text:#111; --muted:#333; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--text); margin:0; padding:16px; }
    .nav { position:sticky; top:0; z-index:10; height:44px; display:flex; align-items:center; justify-content:center; background:var(--bg); }
    .nav-title { margin:0; font-size:1.05rem; font-weight:700; }
    .nav-back { position:absolute; left:12px; top:6px; height:32px; padding:0 8px; display:inline-flex; align-items:center; gap:6px; color:#1f6feb; text-decoration:none; border-radius:8px; }
    .nav-back:before { content:'\2039'; font-size:20px; line-height:1; }
    @media (prefers-color-scheme: dark) { .nav-back { color:#7dd3fc; } }

    .panel { background:var(--panel); max-width:480px; margin:12px auto 24px; padding:20px; border-radius:14px; box-shadow: 0 2px 10px rgba(0,0,0,0.06); }
    h2 { margin:0 0 12px; font-size:1.2rem; text-align:center; }
    .row { display:flex; align-items:center; gap:10px; margin:10px 0; flex-wrap:wrap; }
    label { display:block; font-weight:600; margin:10px 0 6px; }
    input[type=number] { width:100%; max-width:120px; padding:.5em .6em; }
    button, a.button { padding:.85em 1.2em; border:2px solid transparent; border-radius:10px; background:#1f6feb; color:#fff; text-decoration:none; cursor:pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-weight:600; }
    button:hover, a.button:hover { filter: brightness(1.05); }
    .note { color:var(--muted); font-size:.92em; opacity:.85; }

    /* Theme preview */
    .preview { margin-top:16px; }
    .preview-title { font-weight:700; margin-bottom:8px; }
    .preview-card { border-radius:12px; padding:12px; border:1px solid #d1d5db; background:#e0e0e0; }
    .preview .grid { display:grid; grid-template-columns: repeat(4, 1fr); gap:6px; max-width:280px; margin:0 auto; }
    .preview .tile { position:relative; border-radius:10px; border:2px solid #cccccc; background:#ffffff; color:#111; height:44px; display:flex; align-items:center; justify-content:center; font-weight:800; }
    .preview .tile .score { position:absolute; right:6px; bottom:4px; font-size:.7em; opacity:.75; color:#666; }

    /* Dark theme preview */
    .theme-dark .preview-card { background:#1a1f29; border-color:#273449; }
    .theme-dark .preview .tile { background:#111827; border-color:#2a3342; color:#e5e7eb; }
    .theme-dark .preview .tile .score { color:#9ca3af; opacity:.9; }

    /* Auto (OS dark) preview */
    @media (prefers-color-scheme: dark) {
      .preview-card { background:#1a1f29; border-color:#273449; }
      .preview .tile { background:#111827; border-color:#2a3342; color:#e5e7eb; }
      .preview .tile .score { color:#9ca3af; opacity:.9; }
    }

    /* Auto: follow OS when in auto mode (no explicit class) */
    @media (prefers-color-scheme: dark) {
      :root { --bg:#0f1115; --panel:#111827; --text:#e5e7eb; --muted:#9ca3af; }
    }
    /* Force dark */
    .theme-dark { --bg:#0f1115; --panel:#111827; --text:#e5e7eb; --muted:#9ca3af; }
    /* Force light (overrides OS dark) */
    .theme-light { --bg:#f0f0f0; --panel:#ffffff; --text:#111; --muted:#333; }

    /* High contrast preview (overrides theme for accessibility) */
    .high-contrast { background:#ffffff !important; color:#000000 !important; }
    .high-contrast .nav { background:#ffffff !important; }
    .high-contrast .nav-back { color:#000000 !important; }
    .high-contrast .panel { background:#ffffff !important; color:#000000 !important; border:2px solid #000000; }
    .high-contrast h2,
    .high-contrast label,
    .high-contrast .note { color:#000000 !important; opacity:1 !important; }
    .high-contrast input,
    .high-contrast select { background:#ffffff !important; color:#000000 !important; border:2px solid #000000 !important; }
    .high-contrast button,
    .high-contrast a.button { background:#000000 !important; color:#ffffff !important; border:3px solid #000000 !important; }
    .high-contrast a.secondary { background:#666666 !important; color:#ffffff !important; border-color:#000000 !important; }
    .high-contrast .preview-card { background:#ffffff !important; border-color:#000000 !important; }
    .high-contrast .preview .tile { background:transparent !important; color:#000000 !important; border:3px solid #000000 !important; }
    .high-contrast .preview .tile .score { color:#000000 !important; opacity:1 !important; }
  </style>
</head>
<body>
  <div class="nav">
    <a class="nav-back" href="lexfall.html" aria-label="Back">Back</a>
    <h1 class="nav-title">Settings</h1>
  </div>
  <div class="panel">
    <!-- Minimum word length fixed to 2 in app; removed setting -->
    <label class="row"><input id="autoConfirm" type="checkbox"/> Auto-confirm on slide release</label>
    <label class="row"><input id="noAnim" type="checkbox"/> Disable animations (for e-ink devices)</label>
    <label class="row"><input id="highContrast" type="checkbox"/> High contrast mode</label>
    <label class="row"><input id="debug" type="checkbox"/> Debug mode</label>
    <label>Theme</label>
    <div class="row" role="radiogroup" aria-label="Theme">
      <label class="row" style="margin:0; gap:6px;"><input type="radio" name="theme" value="light" id="themeLight"> Light</label>
      <label class="row" style="margin:0; gap:6px;"><input type="radio" name="theme" value="auto" id="themeAuto"> Auto</label>
      <label class="row" style="margin:0; gap:6px;"><input type="radio" name="theme" value="dark" id="themeDark"> Dark</label>
    </div>
    <div class="preview" aria-label="Theme preview">
      <div class="preview-title">Preview</div>
      <div class="preview-card">
        <div class="grid">
          <div class="tile">A<span class="score">1</span></div>
          <div class="tile">E<span class="score">1</span></div>
          <div class="tile">S<span class="score">1</span></div>
          <div class="tile">T<span class="score">1</span></div>
          <div class="tile">R<span class="score">1</span></div>
          <div class="tile">O<span class="score">1</span></div>
          <div class="tile">N<span class="score">1</span></div>
          <div class="tile">Y<span class="score">4</span></div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  // Kindle device detection
  var isKindle = (function(){ 
    try { 
      var ua = (navigator.userAgent || '').toLowerCase(); 
      return /kindle|silk|kfw|kfa|kft|kfj|kfm|kfx|kfk|kfv|kfs|kfg|kfp/.test(ua); 
    } catch(e){ 
      return false; 
    }
  })();

  var settings = { autoConfirm: true, noAnim: false, highContrast: false, debug: false, theme: 'auto' };
  try {
    var raw = localStorage.getItem('lexfall_settings');
    if (raw) {
      var s = JSON.parse(raw);
      if (typeof s.autoConfirm === 'boolean') settings.autoConfirm = s.autoConfirm;
      if (typeof s.noAnim === 'boolean') settings.noAnim = s.noAnim;
      if (typeof s.highContrast === 'boolean') settings.highContrast = s.highContrast;
      if (typeof s.debug === 'boolean') settings.debug = s.debug;
      if (typeof s.theme === 'string' && /^(light|auto|dark)$/.test(s.theme)) settings.theme = s.theme;
    }
  } catch(e){}

  var inputAuto = document.getElementById('autoConfirm');
  var inputNoAnim = document.getElementById('noAnim');
  var inputHighContrast = document.getElementById('highContrast');
  var inputDebug = document.getElementById('debug');
  var themeLight = document.getElementById('themeLight');
  var themeAuto = document.getElementById('themeAuto');
  var themeDark = document.getElementById('themeDark');
  
  inputAuto.checked = !!settings.autoConfirm;
  inputNoAnim.checked = !!settings.noAnim;
  inputHighContrast.checked = !!settings.highContrast;
  inputDebug.checked = !!settings.debug;
  // theme radio
  (settings.theme === 'light' ? themeLight : settings.theme === 'dark' ? themeDark : themeAuto).checked = true;

  function applyThemePreview() {
    document.body.classList.remove('theme-light','theme-dark','high-contrast');
    // High contrast overrides theme for preview
    if (inputHighContrast.checked) {
      document.body.classList.add('high-contrast');
      return;
    }
    if (themeLight.checked) document.body.classList.add('theme-light');
    else if (themeDark.checked) document.body.classList.add('theme-dark');
    // Auto: no class, OS decides via media query
  }

  function persistSettings() {
    var next = {
      autoConfirm: !!inputAuto.checked,
      noAnim: !!inputNoAnim.checked,
      highContrast: !!inputHighContrast.checked,
      debug: !!inputDebug.checked,
      theme: (themeLight.checked ? 'light' : themeDark.checked ? 'dark' : 'auto')
    };
    if (isKindle) next.highContrast = true;
    try { localStorage.setItem('lexfall_settings', JSON.stringify(next)); } catch(e){}
  }

  // Apply initial preview
  applyThemePreview();

  // Live preview and auto-save on user changes
  function onThemeChange() { applyThemePreview(); persistSettings(); }
  themeLight.addEventListener('change', onThemeChange);
  themeAuto.addEventListener('change', onThemeChange);
  themeDark.addEventListener('change', onThemeChange);
  inputHighContrast.addEventListener('change', onThemeChange);

  inputAuto.addEventListener('change', persistSettings);
  inputNoAnim.addEventListener('change', persistSettings);
  inputDebug.addEventListener('change', persistSettings);

  // For Kindle devices, auto-check and disable high contrast mode
  if (isKindle) {
    inputHighContrast.checked = true;
    inputHighContrast.disabled = true;
  }

  // No explicit save button: settings are applied automatically
})();
</script>
</body>
</html>
